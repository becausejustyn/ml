library(tidyverse)
library(scales)
tibble(heads = 0:10, prob = dbinom(x = 0:10, size = 10, prob = 0.5)) %>%
mutate(Heads = ifelse(heads == 8, "8", "other")) %>%
ggplot(aes(x = factor(heads), y = prob, fill = Heads)) +
theme_minimal()+
geom_col() +
geom_text(
aes(label = round(prob, 2), y = prob + 0.01),
position = position_dodge(0.9),
size = 3,
vjust = 0) +
labs(title = "Probability of X = 8 successes",
subtitle = "b(10, .5)",
x = "Successes (x)",
y = "probability")
tibble(rep = 1:10) %>%
#resampling the function as many times as you called in the line above
mutate(samples = map(rep, ~ rnorm(100))) %>%
#mean of each sample
mutate(means = map_dbl(samples, ~ mean(.)))
rerun(10, rnorm(100)) %>%
map_dbl(~ mean(.))
library(tidyverse)   # dplyr, tidyr, ggplot2, etc...
library(emmeans)
library(pROC)
library(lmerTest)
data('Mayflies', package='dsData')
install.packages("dsData")
devtools::install_github("DistanceDevelopment/Distance")
library(Distance)
data('Mayflies', package='Distance')
head(Mayflies)
Mayflies
list(5, 15, -5) %>%
map(rnorm, n = 5) %>%
str()
tribble(
~n, ~mean, ~sd,
10,    0,    1,
20,    5,    1,
30,    10,   2
) %>%
pmap(rnorm) %>%
str()
f <- c("runif", "rnorm", "rpois")
tribble(
~f,      ~params,
"runif", list(min = -1, max = 1,n=10),
"rnorm", list(sd = 5, n=15),
"rpois", list(lambda = 10,n=30)
) %>%
mutate(sim = invoke_map(f, params))
styler:::style_selection()
n_tosses <- 10
one_exp <- rbinom(p = 0.5, size = 1, n_tosses)
mean(one_exp)
sim <- tribble(
~f,      ~params,
"rbinom", list(size = 1, prob = 0.5)
)
sim %>%
mutate(sim = invoke_map(f, params, n = 10)) %>%
unnest(sim) %>%
summarise(mean_sim = mean(sim))
sim <- tribble(
~f,      ~params,
"rbinom", list(size = 1, prob = 0.5)
)
rep_sim <- sim %>%
crossing(rep = 1:1e5) %>%
mutate(sim = invoke_map(f, params, n = 10)) %>%
unnest(sim) %>% #flatten the list
group_by(rep) %>%
summarise(mean_sim = mean(sim))
head(rep_sim)
ggplot(rep_sim) +
aes(x = mean_sim) +
geom_histogram(bins = 10L, fill = "#6FBAD2") +
labs(
x = "Mean Heads",
y = "Count",
title = "Mean 'Heads' fom 10 Coin Tosses"
) +
theme_gray()
ggplot(rep_sim) +
aes(x = mean_sim) +
geom_bar() +
scale_x_binned() +
labs(
x = "Mean Heads",
y = "Count",
title = "Mean 'Heads' fom 10 Coin Tosses"
) +
theme_gray()
set.seed(42)
params <- tribble(
~size, ~prob,
1,     0.5
)
p <- params %>%
crossing(n=1:1e4) %>%
pmap(rbinom) %>%
enframe(name="num_toss",value="observation") %>%
unnest(observation) %>%
group_by(num_toss) %>%
summarise(vale = mean(observation))
p
ggplot(p, aes(num_toss, vale)) +
geom_point(stat = "identity", fill = "purple") +
labs(x = "Number of Heads", y = "Probability of Heads in 10 flips (p)") +
theme_minimal()
p %>%
ggplot(aes(num_toss, vale)) +
geom_point(stat = "identity", fill = "purple", alpha = 0.75) +
labs(
x = "Number of Heads",
y = "Probability of Heads in 10 flips (p)") +
theme_minimal()
p %>%
ggplot(aes(x = num_toss, y = vale)) +
geom_point() +
labs(
x = "x",
y = "y",
title = "Title"
) +
geom_hline(aes(yintercept = 0.5, colour = "pink")) +
#  geom_smooth(method=NULL , color="red", fill="#69b3a2", se=TRUE) +
theme_minimal()
p %>%
ggplot(aes(x = num_toss, y = vale)) +
geom_point() +
labs(
x = "x",
y = "y",
title = "Title"
) +
geom_hline(aes(yintercept = 0.5, colour = "pink")) +
geom_smooth(method=NULL , color="red", fill="#69b3a2", se=TRUE) +
theme_minimal()
p %>%
ggplot(aes(x = num_toss, y = vale)) +
geom_point() +
labs(
x = "x",
y = "y",
title = "Title"
) +
geom_hline(aes(yintercept = 0.5, colour = "pink")) +
theme_minimal()
styler:::style_selection()
sim <- tribble(
~n_tosses, ~f, ~params,
10, "rbinom", list(size = 1, prob = 0.5, n = 15),
30, "rbinom", list(size = 1, prob = 0.5, n = 30),
100, "rbinom", list(size = 1, prob = 0.5, n = 100),
1000, "rbinom", list(size = 1, prob = 0.5, n = 1000),
10000, "rbinom", list(size = 1, prob = 0.5, n = 1e4)
)
sim_rep <- sim %>%
crossing(replication = 1:50) %>%
mutate(sims = invoke_map(f, params)) %>%
unnest(sims) %>%
group_by(replication, n_tosses) %>%
summarise(avg = mean(sims))
sim_rep %>%
ggplot(aes(x = factor(n_tosses), y = avg)) +
ggbeeswarm::geom_quasirandom(color = "lightgrey") +
scale_y_continuous(limits = c(0, 1)) +
geom_hline(
yintercept = 0.5,
color = "skyblue", lty = 1, size = 1, alpha = 3 / 4
) +
ggthemes::theme_pander() +
labs(
title = "50 Replicates Of Mean 'Heads' As Number Of Tosses Increase",
y = "mean",
x = "Number Of Tosses"
)
styler:::style_selection()
library(Lahman)
set.seed(42)
set.seed(42)
# Select 30 players that don't have missing values
# and have a good amount of data (total hits > 500)
players <- Batting %>%
group_by(playerID) %>%
summarise(
AB_total = sum(AB),
H_total = sum(H)
) %>%
na.omit() %>%
filter(H_total > 500) %>% # collect players with a lot of data
sample_n(size = 30) %>% # randomly sample 30 players
pull(playerID)
TRUTH <- Batting %>%
filter(playerID %in% players) %>%
group_by(playerID) %>%
summarise(
AB_total = sum(AB),
H_total = sum(H)
) %>%
mutate(TRUTH = H_total / AB_total) %>%
select(playerID, TRUTH)
set.seed(42)
obs <- Batting %>%
filter(playerID %in% players) %>%
group_by(playerID) %>%
do(sample_n(., 5)) %>%
group_by(playerID) %>%
summarise(
AB_total = sum(AB),
H_total = sum(H)
) %>%
mutate(MLE = H_total / AB_total) %>%
select(playerID, MLE, AB_total) %>%
inner_join(TRUTH, by = "playerID")
p_ <- mean(obs$MLE)
N <- length(obs$MLE)
obs %>% summarise(median(AB_total))
df <- obs %>%
mutate(
sigma2 = (p_ * (1 - p_)) / 1624.5,
JS = p_ + (1 - ((N - 3) * sigma2 / (sum((MLE - p_)^2)))) * (MLE - p_)
) %>%
select(-AB_total, -sigma2)
df
errors <- df %>%
mutate(
mle_pred_error_i = (MLE - TRUTH)^2,
js_pred_error_i = (JS - TRUTH)^2
) %>%
summarise(
js_pred_error = sum(js_pred_error_i),
mle_pred_error = sum(mle_pred_error_i)
)
df
set.seed(42)
sim <- tibble(player = letters,
AB_total=300,
TRUTH = rbeta(100,300,n=26),
hits_list = map(.f=rbinom,TRUTH,n=300,size=1)
)
bats_sim <- sim %>%
unnest(hits_list) %>%
group_by(player) %>%
summarise(Hits = sum(hits_list)) %>%
inner_join(sim, by = "player") %>%
mutate(MLE = Hits/AB_total) %>%
select(-hits_list)
bats_sim
#calculate variables for JS estimator
p_=mean(bats_sim$MLE)
N = length(bats_sim$MLE)
bats_sim <- bats_sim %>%
mutate(sigma2 = (p_*(1-p_))/300,
JS=p_+(1-((N-3)*sigma2/(sum((MLE-p_)^2))))*(MLE-p_)) %>%
select(-AB_total,-Hits,-sigma2)
# plot
bats_sim %>%
gather(type,value,2:4) %>%
mutate(is_truth=+(type=="TRUTH")) %>%
mutate(type = factor(type, levels = c("TRUTH","JS","MLE"))) %>%
arrange(player, type) %>%
ggplot(aes(x=value,y=type))+
geom_path(aes(group=player),lty=2,color="lightgrey")+
scale_color_manual(values=c("lightgrey", "skyblue"))+ #truth==skyblue
geom_point(aes(color=factor(is_truth)))+
guides(color=FALSE)+ #remove legend
labs(title="The James-Stein Estimator Shrinks the MLE")+
theme_minimal()
errors <- bats_sim %>%
mutate(mle_pred_error_i = (MLE-TRUTH)^2,
js_pred_error_i = (JS-TRUTH)^2) %>%
summarise(js_pred_error = sum(js_pred_error_i),
mle_pred_error = sum(mle_pred_error_i))
errors
